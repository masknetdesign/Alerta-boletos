<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerta de Boletos - Lembrete de Pagamentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .bill-card {
            transition: all 0.3s ease;
        }
        .bill-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .urgent {
            border-left: 4px solid #ef4444;
        }
        .warning {
            border-left: 4px solid #f59e0b;
        }
        .normal {
            border-left: 4px solid #10b981;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-indigo-700">
                    <i class="fas fa-bell mr-2"></i> Alerta de Boletos
                </h1>
                <div class="relative">
                    <button id="notificationBtn" class="p-2 rounded-full bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notificationCount" class="notification-badge hidden">0</span>
                    </button>
                </div>
                <!-- Sound Controls -->
                <div class="flex items-center space-x-2 ml-4">
                    <button id="soundToggle" class="p-2 rounded-full bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition">
                        <i class="fas fa-volume-up text-xl"></i>
                    </button>
                    <div class="w-24">
                        <input type="range" id="volumeControl" min="0" max="100" value="50" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
            </div>
            <p class="text-gray-600 mt-2">Nunca mais perca o prazo de pagamento dos seus boletos</p>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Add Bill Form -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-1 order-2 lg:order-1">
                <h2 class="text-xl font-semibold mb-4 text-indigo-700">
                    <i class="fas fa-plus-circle mr-2"></i> Adicionar Boleto
                </h2>
                <form id="billForm" class="space-y-4">
                    <div>
                        <label for="billName" class="block text-sm font-medium text-gray-700 mb-1">Nome do Boleto</label>
                        <input type="text" id="billName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: Conta de Luz" required>
                    </div>
                    
                    <div>
                        <label for="billValue" class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                        <input type="number" id="billValue" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0,00" required>
                    </div>
                    
                    <div>
                        <label for="billDueDate" class="block text-sm font-medium text-gray-700 mb-1">Data de Vencimento</label>
                        <input type="datetime-local" id="billDueDate" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i> Salvar Boleto
                    </button>
                </form>
            </div>

            <!-- Bills List -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2 order-1 lg:order-2">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-indigo-700">
                        <i class="fas fa-list-alt mr-2"></i> Meus Boletos
                    </h2>
                    <div class="flex space-x-2">
                        <button id="filterAll" class="px-3 py-1 bg-indigo-600 text-white rounded-md text-sm">Todos</button>
                        <button id="filterPending" class="px-3 py-1 bg-gray-200 rounded-md text-sm">Pendentes</button>
                        <button id="filterPaid" class="px-3 py-1 bg-gray-200 rounded-md text-sm">Pagados</button>
                    </div>
                </div>

                <div id="billsContainer" class="space-y-4">
                    <!-- Sample bill (will be populated by JavaScript) -->
                    <div class="text-center py-10 text-gray-500" id="emptyState">
                        <i class="fas fa-file-invoice-dollar text-4xl mb-3"></i>
                        <p>Nenhum boleto cadastrado ainda</p>
                        <p class="text-sm mt-1">Adicione seu primeiro boleto usando o formulário ao lado</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Modal -->
        <div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-indigo-700">
                        <i class="fas fa-bell mr-2"></i> Notificações
                    </h3>
                    <button id="closeNotificationModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="notificationList" class="space-y-3 max-h-60 overflow-y-auto">
                    <!-- Notifications will be added here -->
                </div>
                <div id="emptyNotifications" class="text-center py-5 text-gray-500">
                    <i class="fas fa-bell-slash text-3xl mb-2"></i>
                    <p>Nenhuma notificação no momento</p>
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="clearNotifications" class="px-4 py-2 bg-gray-200 rounded-md text-sm hover:bg-gray-300">Limpar Tudo</button>
                </div>
            </div>
        </div>

        <!-- Alarm Modal -->
        <div id="alarmModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 class="text-xl font-bold text-indigo-700 mb-4">
                    <i class="fas fa-bell mr-2"></i> Alerta de Boleto!
                </h3>
                <p id="alarmMessage" class="mb-4"></p>
                <div class="flex justify-center space-x-4">
                    <button id="snoozeAlarm" class="px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600">
                        <i class="fas fa-clock mr-2"></i> Adiar (5 min)
                    </button>
                    <button id="dismissAlarm" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                        <i class="fas fa-check mr-2"></i> Entendido
                    </button>
                </div>
            </div>
        </div>

        <!-- Visual Alert -->
        <div id="visualAlert" class="fixed top-0 left-0 w-full h-1 bg-red-500 transform -translate-y-full transition-transform duration-300"></div>

        <!-- Notification Sound -->
        <audio id="notificationSound" preload="auto">
            <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const billForm = document.getElementById('billForm');
            const billsContainer = document.getElementById('billsContainer');
            const emptyState = document.getElementById('emptyState');
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationModal = document.getElementById('notificationModal');
            const closeNotificationModal = document.getElementById('closeNotificationModal');
            const notificationList = document.getElementById('notificationList');
            const emptyNotifications = document.getElementById('emptyNotifications');
            const clearNotifications = document.getElementById('clearNotifications');
            const notificationCount = document.getElementById('notificationCount');
            const alarmModal = document.getElementById('alarmModal');
            const alarmMessage = document.getElementById('alarmMessage');
            const snoozeAlarm = document.getElementById('snoozeAlarm');
            const dismissAlarm = document.getElementById('dismissAlarm');
            const filterAll = document.getElementById('filterAll');
            const filterPending = document.getElementById('filterPending');
            const filterPaid = document.getElementById('filterPaid');
            const visualAlert = document.getElementById('visualAlert');
            const notificationSound = document.getElementById('notificationSound');
            const soundToggle = document.getElementById('soundToggle');
            const volumeControl = document.getElementById('volumeControl');
            
            // State
            let bills = JSON.parse(localStorage.getItem('bills')) || [];
            let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            let currentFilter = 'all';
            let alarmTimeouts = {};
            let snoozeTimeouts = {};
            let visualAlertTimeout = null;
            let soundEnabled = localStorage.getItem('soundEnabled') === 'true';
            let soundInitialized = false;
            
            // Initialize
            renderBills();
            updateNotificationBadge();
            checkDueBills();
            setupAlarms();
            updateSoundUI();
            initializeSound();

            // Set up interval to check for due bills every minute
            setInterval(checkDueBills, 60000);

            // Event Listeners
            billForm.addEventListener('submit', addBill);
            notificationBtn.addEventListener('click', toggleNotificationModal);
            closeNotificationModal.addEventListener('click', toggleNotificationModal);
            clearNotifications.addEventListener('click', clearAllNotifications);
            filterAll.addEventListener('click', () => changeFilter('all'));
            filterPending.addEventListener('click', () => changeFilter('pending'));
            filterPaid.addEventListener('click', () => changeFilter('paid'));
            snoozeAlarm.addEventListener('click', snoozeCurrentAlarm);
            dismissAlarm.addEventListener('click', dismissCurrentAlarm);
            soundToggle.addEventListener('click', toggleSound);
            volumeControl.addEventListener('input', updateVolume);

            // Functions
            function addBill(e) {
                e.preventDefault();
                
                const name = document.getElementById('billName').value;
                const value = parseFloat(document.getElementById('billValue').value);
                const dueDate = document.getElementById('billDueDate').value;
                
                const newBill = {
                    id: Date.now(),
                    name,
                    value,
                    dueDate: new Date(dueDate).toISOString(),
                    paid: false,
                    createdAt: new Date().toISOString()
                };
                
                bills.push(newBill);
                saveBills();
                renderBills();
                billForm.reset();
                
                // Setup alarm for this new bill
                setupAlarm(newBill);
                
                // Show success message
                showToast('Boleto adicionado com sucesso!', 'success');
            }

            function renderBills() {
                if (bills.length === 0) {
                    emptyState.classList.remove('hidden');
                    billsContainer.innerHTML = '';
                    billsContainer.appendChild(emptyState);
                    return;
                }
                
                emptyState.classList.add('hidden');
                
                // Filter bills based on current filter
                let filteredBills = [...bills];
                if (currentFilter === 'pending') {
                    filteredBills = bills.filter(bill => !bill.paid);
                } else if (currentFilter === 'paid') {
                    filteredBills = bills.filter(bill => bill.paid);
                }
                
                // Sort by due date (ascending)
                filteredBills.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                
                billsContainer.innerHTML = '';
                
                filteredBills.forEach(bill => {
                    const dueDate = new Date(bill.dueDate);
                    const now = new Date();
                    const timeDiff = dueDate - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let urgencyClass = 'normal';
                    let urgencyText = '';
                    
                    if (!bill.paid) {
                        if (daysDiff <= 0) {
                            urgencyClass = 'urgent';
                            urgencyText = 'Vencido!';
                        } else if (daysDiff <= 3) {
                            urgencyClass = 'warning';
                            urgencyText = `Vence em ${daysDiff} dia${daysDiff > 1 ? 's' : ''}`;
                        } else {
                            urgencyText = `Vence em ${daysDiff} dia${daysDiff > 1 ? 's' : ''}`;
                        }
                    }
                    
                    const billElement = document.createElement('div');
                    billElement.className = `bill-card p-4 rounded-md border border-gray-200 ${urgencyClass} relative`;
                    billElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-lg">${bill.name}</h3>
                            </div>
                            <span class="font-bold text-lg">R$ ${bill.value.toFixed(2)}</span>
                        </div>
                        
                        <div class="flex justify-between items-center mt-4">
                            <div>
                                <p class="text-sm ${!bill.paid && daysDiff <= 3 ? 'font-semibold' : 'text-gray-600'}">
                                    <i class="far fa-calendar-alt mr-1"></i> 
                                    ${dueDate.toLocaleDateString()} às ${dueDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </p>
                                ${!bill.paid ? `<p class="text-sm ${daysDiff <= 3 ? 'text-red-500 font-semibold' : 'text-gray-600'}">
                                    <i class="fas fa-exclamation-circle mr-1"></i> ${urgencyText}
                                </p>` : ''}
                            </div>
                            
                            <div class="flex space-x-2">
                                ${!bill.paid ? `
                                <button onclick="markAsPaid(${bill.id})" class="px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition">
                                    <i class="fas fa-check mr-1"></i> Pagar
                                </button>
                                ` : `
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-md text-sm">
                                    <i class="fas fa-check-circle mr-1"></i> Pago
                                </span>
                                `}
                                <button onclick="deleteBill(${bill.id})" class="px-3 py-1 bg-red-100 text-red-600 rounded-md text-sm hover:bg-red-200 transition">
                                    <i class="fas fa-trash-alt mr-1"></i> Excluir
                                </button>
                            </div>
                        </div>
                    `;
                    
                    billsContainer.appendChild(billElement);
                });
            }

            function markAsPaid(id) {
                const billIndex = bills.findIndex(bill => bill.id === id);
                if (billIndex !== -1) {
                    bills[billIndex].paid = true;
                    saveBills();
                    renderBills();
                    
                    // Clear any existing alarm for this bill
                    clearAlarm(id);
                    
                    showToast('Boleto marcado como pago!', 'success');
                }
            }

            function deleteBill(id) {
                if (confirm('Tem certeza que deseja excluir este boleto?')) {
                    bills = bills.filter(bill => bill.id !== id);
                    saveBills();
                    renderBills();
                    
                    // Clear any existing alarm for this bill
                    clearAlarm(id);
                    
                    showToast('Boleto excluído com sucesso!', 'info');
                }
            }

            function saveBills() {
                localStorage.setItem('bills', JSON.stringify(bills));
            }

            function setupAlarms() {
                // Clear all existing alarms
                Object.values(alarmTimeouts).forEach(timeout => clearTimeout(timeout));
                Object.values(snoozeTimeouts).forEach(timeout => clearTimeout(timeout));
                alarmTimeouts = {};
                snoozeTimeouts = {};
                
                // Setup alarms for all unpaid bills
                bills.forEach(bill => {
                    if (!bill.paid) {
                        setupAlarm(bill);
                    }
                });
            }

            function setupAlarm(bill) {
                const now = new Date();
                const dueDate = new Date(bill.dueDate);
                const timeUntilDue = dueDate - now;
                
                // Only set alarm if the due date is in the future
                if (timeUntilDue > 0) {
                    // Clear any existing alarm for this bill
                    clearAlarm(bill.id);
                    
                    // Set new alarm
                    alarmTimeouts[bill.id] = setTimeout(() => {
                        triggerAlarm(bill);
                    }, timeUntilDue);
                    
                    console.log(`Alarme configurado para boleto ${bill.id} às ${dueDate}`);
                }
            }

            function clearAlarm(billId) {
                if (alarmTimeouts[billId]) {
                    clearTimeout(alarmTimeouts[billId]);
                    delete alarmTimeouts[billId];
                }
                if (snoozeTimeouts[billId]) {
                    clearTimeout(snoozeTimeouts[billId]);
                    delete snoozeTimeouts[billId];
                }
            }

            function triggerAlarm(bill) {
                // Show visual alert
                showVisualAlert('urgent');
                
                // Play notification sound
                playNotificationSound();
                
                // Show alarm modal
                alarmMessage.textContent = `O boleto "${bill.name}" venceu agora! Valor: R$ ${bill.value.toFixed(2)}`;
                alarmModal.classList.remove('hidden');
                
                // Store current bill ID in modal dataset
                alarmModal.dataset.billId = bill.id;
                
                // Add notification
                const notification = {
                    id: Date.now(),
                    billId: bill.id,
                    type: 'alarm',
                    message: `O boleto ${bill.name} venceu agora!`,
                    value: bill.value,
                    dueDate: bill.dueDate,
                    read: false,
                    createdAt: new Date().toISOString()
                };
                notifications.push(notification);
                saveNotifications();
                updateNotificationBadge();
                
                // If notification modal is open, update it
                if (!notificationModal.classList.contains('hidden')) {
                    renderNotifications();
                }
            }

            function snoozeCurrentAlarm() {
                const billId = parseInt(alarmModal.dataset.billId);
                const bill = bills.find(b => b.id === billId);
                
                if (bill) {
                    // Hide modal
                    alarmModal.classList.add('hidden');
                    
                    // Snooze for 5 minutes
                    const snoozeDuration = 5 * 60 * 1000; // 5 minutes in milliseconds
                    
                    snoozeTimeouts[billId] = setTimeout(() => {
                        triggerAlarm(bill);
                    }, snoozeDuration);
                    
                    showToast(`Alarme adiado por 5 minutos para o boleto ${bill.name}`, 'info');
                }
            }

            function dismissCurrentAlarm() {
                const billId = parseInt(alarmModal.dataset.billId);
                
                // Hide modal
                alarmModal.classList.add('hidden');
                
                // Clear any snooze timeout for this bill
                if (snoozeTimeouts[billId]) {
                    clearTimeout(snoozeTimeouts[billId]);
                    delete snoozeTimeouts[billId];
                }
            }

            function checkDueBills() {
                const now = new Date();
                let hasNewNotification = false;
                
                bills.forEach(bill => {
                    if (bill.paid) return;
                    
                    const dueDate = new Date(bill.dueDate);
                    const timeDiff = dueDate - now;
                    const minutesDiff = Math.floor(timeDiff / (1000 * 60));
                    
                    // Check if bill is due in the next 15 minutes or is overdue
                    if (minutesDiff <= 15 && minutesDiff > -1440) {
                        const notificationExists = notifications.some(
                            n => n.billId === bill.id && n.type === 'due_reminder'
                        );
                        
                        if (!notificationExists) {
                            hasNewNotification = true;
                            const notification = {
                                id: Date.now(),
                                billId: bill.id,
                                type: 'due_reminder',
                                message: `O boleto ${bill.name} está ${minutesDiff <= 0 ? 'vencido' : `prestes a vencer (em ${minutesDiff} min)`}`,
                                value: bill.value,
                                dueDate: bill.dueDate,
                                read: false,
                                createdAt: new Date().toISOString()
                            };
                            notifications.push(notification);
                        }
                    }
                });
                
                if (hasNewNotification) {
                    saveNotifications();
                    updateNotificationBadge();
                    showVisualAlert(minutesDiff <= 0 ? 'urgent' : 'normal');
                    playNotificationSound();
                    
                    if (!notificationModal.classList.contains('hidden')) {
                        renderNotifications();
                    }
                    
                    if (notifications.length > 0) {
                        const latestNotification = notifications[notifications.length - 1];
                        showToast(latestNotification.message, 'warning');
                    }
                }
            }

            function toggleNotificationModal() {
                notificationModal.classList.toggle('hidden');
                if (!notificationModal.classList.contains('hidden')) {
                    renderNotifications();
                    markNotificationsAsRead();
                }
            }

            function renderNotifications() {
                if (notifications.length === 0) {
                    emptyNotifications.classList.remove('hidden');
                    notificationList.innerHTML = '';
                    return;
                }
                
                emptyNotifications.classList.add('hidden');
                notificationList.innerHTML = '';
                
                // Sort by creation date (newest first)
                const sortedNotifications = [...notifications].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                sortedNotifications.forEach(notification => {
                    const dueDate = new Date(notification.dueDate);
                    const notificationElement = document.createElement('div');
                    notificationElement.className = `p-3 rounded-md ${notification.read ? 'bg-gray-50' : 'bg-indigo-50'} border border-gray-200`;
                    notificationElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium ${notification.read ? 'text-gray-700' : 'text-indigo-700'}">
                                    ${notification.message}
                                </p>
                                <p class="text-sm text-gray-500 mt-1">
                                    <i class="far fa-clock mr-1"></i> 
                                    ${new Date(notification.createdAt).toLocaleString()}
                                </p>
                                ${notification.value ? `<p class="text-sm mt-1">
                                    <i class="fas fa-money-bill-wave mr-1"></i> 
                                    R$ ${notification.value.toFixed(2)}
                                </p>` : ''}
                            </div>
                            <button onclick="deleteNotification(${notification.id})" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    notificationList.appendChild(notificationElement);
                });
            }

            function markNotificationsAsRead() {
                notifications = notifications.map(notification => ({
                    ...notification,
                    read: true
                }));
                saveNotifications();
                updateNotificationBadge();
            }

            function deleteNotification(id) {
                notifications = notifications.filter(notification => notification.id !== id);
                saveNotifications();
                renderNotifications();
                updateNotificationBadge();
            }

            function clearAllNotifications() {
                if (confirm('Tem certeza que deseja limpar todas as notificações?')) {
                    notifications = [];
                    saveNotifications();
                    renderNotifications();
                    updateNotificationBadge();
                }
            }

            function saveNotifications() {
                localStorage.setItem('notifications', JSON.stringify(notifications));
            }

            function updateNotificationBadge() {
                const unreadCount = notifications.filter(n => !n.read).length;
                if (unreadCount > 0) {
                    notificationCount.textContent = unreadCount;
                    notificationCount.classList.remove('hidden');
                    notificationBtn.classList.add('pulse-animation');
                } else {
                    notificationCount.classList.add('hidden');
                    notificationBtn.classList.remove('pulse-animation');
                }
            }

            function showToast(message, type) {
                const toast = document.createElement('div');
                toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg text-white ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'error' ? 'bg-red-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                }`;
                toast.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 
                            type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'
                        } mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            function changeFilter(filter) {
                currentFilter = filter;
                
                // Update button styles
                filterAll.classList.remove('bg-indigo-600', 'text-white');
                filterPending.classList.remove('bg-indigo-600', 'text-white');
                filterPaid.classList.remove('bg-indigo-600', 'text-white');
                
                filterAll.classList.add('bg-gray-200');
                filterPending.classList.add('bg-gray-200');
                filterPaid.classList.add('bg-gray-200');
                
                if (filter === 'all') {
                    filterAll.classList.remove('bg-gray-200');
                    filterAll.classList.add('bg-indigo-600', 'text-white');
                } else if (filter === 'pending') {
                    filterPending.classList.remove('bg-gray-200');
                    filterPending.classList.add('bg-indigo-600', 'text-white');
                } else if (filter === 'paid') {
                    filterPaid.classList.remove('bg-gray-200');
                    filterPaid.classList.add('bg-indigo-600', 'text-white');
                }
                
                renderBills();
            }

            function showVisualAlert(type = 'normal') {
                if (visualAlertTimeout) {
                    clearTimeout(visualAlertTimeout);
                }

                visualAlert.style.backgroundColor = type === 'urgent' ? '#ef4444' : '#f59e0b';
                visualAlert.classList.remove('-translate-y-full');
                
                visualAlertTimeout = setTimeout(() => {
                    visualAlert.classList.add('-translate-y-full');
                }, 3000);
            }

            function toggleSound() {
                if (!soundInitialized) {
                    testSound();
                } else {
                    soundEnabled = !soundEnabled;
                    localStorage.setItem('soundEnabled', soundEnabled);
                    updateSoundUI();
                    showToast(soundEnabled ? 'Som ativado' : 'Som desativado', 'info');
                }
            }

            function updateVolume() {
                const volume = volumeControl.value / 100;
                notificationSound.volume = volume;
                localStorage.setItem('soundVolume', volumeControl.value);
            }

            function updateSoundUI() {
                if (soundEnabled) {
                    soundToggle.classList.remove('bg-red-100', 'text-red-700');
                    soundToggle.classList.add('bg-indigo-100', 'text-indigo-700');
                    soundToggle.querySelector('i').className = 'fas fa-volume-up text-xl';
                } else {
                    soundToggle.classList.remove('bg-indigo-100', 'text-indigo-700');
                    soundToggle.classList.add('bg-red-100', 'text-red-700');
                    soundToggle.querySelector('i').className = 'fas fa-volume-mute text-xl';
                }
            }

            function playNotificationSound() {
                if (soundEnabled && soundInitialized) {
                    notificationSound.currentTime = 0;
                    notificationSound.play().catch(error => {
                        console.log('Erro ao tocar som:', error);
                    });
                }
            }

            function initializeSound() {
                // Carrega o som
                notificationSound.load();
                
                // Configura o volume inicial
                const savedVolume = localStorage.getItem('soundVolume') || 50;
                volumeControl.value = savedVolume;
                notificationSound.volume = savedVolume / 100;
                
                // Tenta inicializar o som
                if (soundEnabled) {
                    testSound();
                }
            }

            function testSound() {
                notificationSound.currentTime = 0;
                notificationSound.play().then(() => {
                    soundInitialized = true;
                    showToast('Som inicializado com sucesso!', 'success');
                }).catch(error => {
                    console.log('Erro ao inicializar som:', error);
                    showToast('Não foi possível inicializar o som. Verifique as permissões do navegador.', 'error');
                    soundEnabled = false;
                    localStorage.setItem('soundEnabled', 'false');
                    updateSoundUI();
                });
            }

            // Make functions available globally for button clicks
            window.markAsPaid = markAsPaid;
            window.deleteBill = deleteBill;
            window.deleteNotification = deleteNotification;
        });
    </script>
</body>
</html>